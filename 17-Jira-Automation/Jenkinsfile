pipeline {
    agent any
    

    parameters {
        choice(name: 'PROJECT',choices: ['System Team - Platform Engineering (STPE)'], description: "Please enter the Project name")
        choice(name: 'Issue Type',choices: ['Story'], description: "Enter the Issue type")
        string(name: 'Summary',defaultValue: '',description: "Issue Summary")
        choice(name: 'Assignee',choices: ['Abhishek Alimchandani','Vandan Banda'],description: "Select whom should it be assigned to")
        choice(name: 'Reporter',choices: ['Tammy Reid'], description: "Select your reporter")
        choice(name: 'Epic Link',choices: ['Jenkins Stabilization & Performance Enhancements'],description: "Enter your Epic Link")
        //choice(name: 'Component/s',choices: ['Jenkins'],description: "Enter the components")
        string(name: 'Description',defaultValue: '', description: "Enter the entire description about the Story")
    }

    enviornment{
        JIRA_BASE_URL = 'https://abhishekalimchandani1624.atlassian.net'
        JIRA_USER = "abhishekalimchandani1624@gmail.com"
        JIRA_TOKEN = "ATATT3xFfGF0d9NMW5qDmiGFjKWg9VTEEG4nfjICwwm7SvvbDUYxhkzYY-XZ0OUcr-kBGuww0x5djbeKzOu3Fkvg_aqWBf7nfI8E1steXBkk_tLr018gatYC-fBPXcUHTLQ72YOtIsyy4d7-EpupSB1jssMi2yMc_Jkl4J03Qh0VhP45NeTRD9E=44C2A34D"
    }

    stages{
        stage('Create Jira Story'){
            steps{
                script {
                    def jira = load "${env.WORKSPACE}/jiraUtil.groovy"
                    
                    def story = jira.createJiraStory(
                        env.JIRA_BASE_URL,
                        env.JIRA_USER,
                        env.JIRA_TOKEN,
                        params.PROJECT,
                        params['Issue Type'],
                        params.Summary,
                        params.Assignee,
                        params.Reporter,
                        params['Epic Link'],
                        params.Description
                    )

                    echo "âœ… Created JIRA Story ${story.key}"
                }
            }
        }
    }
}